<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Steven M. Mortimer" />

<meta name="date" content="2020-06-07" />

<title>Working with Attachments</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Working with Attachments</h1>
<h4 class="author">Steven M. Mortimer</h4>
<h4 class="date">2020-06-07</h4>


<div id="TOC">
<ul>
<li><a href="#attachments-in-salesforce">Attachments in Salesforce</a></li>
<li><a href="#creating-uploading-attachments">Creating (Uploading) Attachments</a></li>
<li><a href="#downloading-attachments">Downloading Attachments</a></li>
<li><a href="#extending-to-documents-and-other-blob-data">Extending to Documents and Other Blob Data</a></li>
<li><a href="#reference-links">Reference Links</a></li>
</ul>
</div>

<div id="attachments-in-salesforce" class="section level3">
<h3>Attachments in Salesforce</h3>
<p>Almost all records in Salesforce support attachments. Attachments are just blob data storage for an associated ParentId. A ParentId is the 18-character Salesforcer Id of the record that the attachment belongs to. To get started creating and updating attachments, first, load the <strong>salesforcer</strong> and <strong>dplyr</strong> packages and login, if needed.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(here)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(salesforcer)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">sf_auth</span>()</span></code></pre></div>
<p>The Attachment data, for example, the attachment’s Id, ParentId, Name, Body, ModifiedDate, and other attributes are stored in the Attachment object, a Standard Object in Salesforce.</p>
</div>
<div id="creating-uploading-attachments" class="section level3">
<h3>Creating (Uploading) Attachments</h3>
<p>Below we will cover 2 different methods of creating attachments:</p>
<ol style="list-style-type: decimal">
<li>Uploading local files as Attachments one at a time using the SOAP and REST API (most common usage)</li>
<li>Uploading large batches of files using the Bulk API, which zips the files before upload</li>
</ol>
<p><strong>Uploading local files as Attachments (SOAP and REST)</strong></p>
<p>When uploading an attachment stored locally (i.e. on your computer), you can provide an absolute or relative path to the current working directory. If the <code>Name</code> column is omitted, then the name of the attachment as it appears in Salesforce will be the same as the base file name and extension. For example, if the path provided is “/Documents/attachments/doc1.pdf”, then the <code>Name</code> field will be set to “doc1.pdf”. In the sample code below we are leveraging the <strong>here</strong> package to consistently create relative paths. Although, this is not required, it is encouraged to increase the portability of your code.</p>
<p>In the example below, we upload three attachments to two different parent records. Note: Make sure to replace the paths and ParentIds in the example below with file paths that exist on your local machine and Ids of records in your Salesforce org.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># define the ParentIds where the attachments will be shown in Salesforce</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>parent_record_id1 &lt;-<span class="st"> &quot;0016A0000035mJ4&quot;</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>parent_record_id2 &lt;-<span class="st"> &quot;0016A0000035mJ5&quot;</span></span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co"># provide the file paths of where the attachments exist locally on your machine</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co"># in this case we are referencing images included within the salesforcer package, </span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co"># but any absolute or relative path locally will work</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>file_path1 &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;cloud.png&quot;</span>, <span class="dt">package=</span><span class="st">&quot;salesforcer&quot;</span>)</span>
<span id="cb2-9"><a href="#cb2-9"></a>file_path2 &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;logo.png&quot;</span>, <span class="dt">package=</span><span class="st">&quot;salesforcer&quot;</span>)</span>
<span id="cb2-10"><a href="#cb2-10"></a>file_path3 &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;old-logo.png&quot;</span>, <span class="dt">package=</span><span class="st">&quot;salesforcer&quot;</span>)</span>
<span id="cb2-11"><a href="#cb2-11"></a></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co"># create a data.frame or tbl_df out of this information</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>attachment_details &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Body =</span> <span class="kw">rep</span>(<span class="kw">c</span>(file_path1, </span>
<span id="cb2-14"><a href="#cb2-14"></a>                                          file_path2, </span>
<span id="cb2-15"><a href="#cb2-15"></a>                                          file_path3), </span>
<span id="cb2-16"><a href="#cb2-16"></a>                                        <span class="dt">times=</span><span class="dv">2</span>),</span>
<span id="cb2-17"><a href="#cb2-17"></a>                             <span class="dt">ParentId =</span> <span class="kw">rep</span>(<span class="kw">c</span>(parent_record_id1, </span>
<span id="cb2-18"><a href="#cb2-18"></a>                                              parent_record_id2), </span>
<span id="cb2-19"><a href="#cb2-19"></a>                                            <span class="dt">each=</span><span class="dv">3</span>))</span>
<span id="cb2-20"><a href="#cb2-20"></a></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="co"># create the attachments!</span></span>
<span id="cb2-22"><a href="#cb2-22"></a>result &lt;-<span class="st"> </span><span class="kw">sf_create_attachment</span>(attachment_details)</span>
<span id="cb2-23"><a href="#cb2-23"></a>result</span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="co">#&gt; # A tibble: 6 x 2</span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="co">#&gt;   id                 success</span></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="co">#&gt;   &lt;chr&gt;              &lt;lgl&gt;  </span></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="co">#&gt; 1 00P3s00000YvpLsEAJ TRUE   </span></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="co">#&gt; 2 00P3s00000YvpLxEAJ TRUE   </span></span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="co">#&gt; 3 00P3s00000YvpM2EAJ TRUE   </span></span>
<span id="cb2-30"><a href="#cb2-30"></a><span class="co">#&gt; 4 00P3s00000YvpM7EAJ TRUE   </span></span>
<span id="cb2-31"><a href="#cb2-31"></a><span class="co">#&gt; 5 00P3s00000YvpMCEAZ TRUE   </span></span>
<span id="cb2-32"><a href="#cb2-32"></a><span class="co">#&gt; 6 00P3s00000YvpMHEAZ TRUE</span></span></code></pre></div>
</div>
<div id="downloading-attachments" class="section level3">
<h3>Downloading Attachments</h3>
<p>After uploading attachments to Salesforce you can download them by first querying the metadata in the Attachment object. This metadata provides the Id for the blob data attachment for download. A convenience function, <code>sf_download_attachment()</code>, has been created to download attachments quickly. The example below shows how to query the metadata of attachments belonging to particular ParentId.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># pull down all attachments associated with a particular record</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>queried_attachments &lt;-<span class="st"> </span><span class="kw">sf_query</span>(<span class="kw">sprintf</span>(<span class="st">&quot;SELECT Id, Body, Name, ParentId</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="st">                                         FROM Attachment</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="st">                                         WHERE ParentId IN (&#39;%s&#39;, &#39;%s&#39;)&quot;</span>, </span>
<span id="cb3-5"><a href="#cb3-5"></a>                                         parent_record_id1, parent_record_id2))</span>
<span id="cb3-6"><a href="#cb3-6"></a>queried_attachments</span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt; # A tibble: 6 x 4</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt;   Id            Body                                     Name      ParentId     </span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt;                                    &lt;chr&gt;     &lt;chr&gt;        </span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">#&gt; 1 00P3s00000Yv… /services/data/v48.0/sobjects/Attachmen… cloud.png 0016A0000035…</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt; 2 00P3s00000Yv… /services/data/v48.0/sobjects/Attachmen… logo.png  0016A0000035…</span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">#&gt; 3 00P3s00000Yv… /services/data/v48.0/sobjects/Attachmen… old-logo… 0016A0000035…</span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">#&gt; 4 00P3s00000Yv… /services/data/v48.0/sobjects/Attachmen… old-logo… 0016A0000035…</span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">#&gt; 5 00P3s00000Yv… /services/data/v48.0/sobjects/Attachmen… cloud.png 0016A0000035…</span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">#&gt; 6 00P3s00000Yv… /services/data/v48.0/sobjects/Attachmen… logo.png  0016A0000035…</span></span></code></pre></div>
<p>Before downloading the attachments using the Body it is important to consider whether the attachment names are repeated or duplicates. If so, then the attachments with the same exact name will be overwritten on the local filesystem as they are downloaded. To avoid this problem there are two common strategies:</p>
<ol style="list-style-type: decimal">
<li>Create a new column (e.g. <code>unique_name</code>) that is the concatenation of the Attachment Id and the Attachment’s name which is guaranteed to be unique.</li>
<li>Save the attachments in separate folders for each ParentId record.</li>
</ol>
<p>As long as the same ParentId record doesn’t name attachments with the same name, then Strategy #2 above will work. In addition, it may help better organize the documents if you are planning to download many and then upload again to Salesforce using the Bulk API as demonstrated later in this script.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># create a new folder for each ParentId in the dataset</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>temp_dir &lt;-<span class="st"> </span><span class="kw">tempdir</span>()</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="cf">for</span> (pid <span class="cf">in</span> <span class="kw">unique</span>(queried_attachments<span class="op">$</span>ParentId)){</span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="kw">dir.create</span>(<span class="kw">file.path</span>(temp_dir, pid), <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>) <span class="co"># ignore if already exists</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>}</span>
<span id="cb4-6"><a href="#cb4-6"></a></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co"># create a new columns in the queried data so that we can pass this information </span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co"># on to the function `sf_download_attachment()` that will actually perform the download</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>queried_attachments &lt;-<span class="st"> </span>queried_attachments <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="st">  </span><span class="co"># Strategy 1: Unique file names (ununsed here, but shown as an example)</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">unique_name =</span> <span class="kw">paste</span>(Id, Name, <span class="dt">sep=</span><span class="st">&#39;___&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="st">  </span><span class="co"># Strategy 2: Separate folders per parent</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Path =</span> <span class="kw">file.path</span>(temp_dir, ParentId))</span>
<span id="cb4-14"><a href="#cb4-14"></a></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co"># download all of the attachments for a single ParentId record to their own folder</span></span>
<span id="cb4-16"><a href="#cb4-16"></a>download_result &lt;-<span class="st"> </span><span class="kw">mapply</span>(sf_download_attachment, </span>
<span id="cb4-17"><a href="#cb4-17"></a>                          queried_attachments<span class="op">$</span>Body, </span>
<span id="cb4-18"><a href="#cb4-18"></a>                          queried_attachments<span class="op">$</span>Name, </span>
<span id="cb4-19"><a href="#cb4-19"></a>                          queried_attachments<span class="op">$</span>Path)</span>
<span id="cb4-20"><a href="#cb4-20"></a>download_result</span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co">#&gt; /services/data/v48.0/sobjects/Attachment/00P3s00000YvpLsEAJ/Body </span></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="co">#&gt;                                                             TRUE </span></span>
<span id="cb4-23"><a href="#cb4-23"></a><span class="co">#&gt; /services/data/v48.0/sobjects/Attachment/00P3s00000YvpLxEAJ/Body </span></span>
<span id="cb4-24"><a href="#cb4-24"></a><span class="co">#&gt;                                                             TRUE </span></span>
<span id="cb4-25"><a href="#cb4-25"></a><span class="co">#&gt; /services/data/v48.0/sobjects/Attachment/00P3s00000YvpM2EAJ/Body </span></span>
<span id="cb4-26"><a href="#cb4-26"></a><span class="co">#&gt;                                                             TRUE </span></span>
<span id="cb4-27"><a href="#cb4-27"></a><span class="co">#&gt; /services/data/v48.0/sobjects/Attachment/00P3s00000YvpMHEAZ/Body </span></span>
<span id="cb4-28"><a href="#cb4-28"></a><span class="co">#&gt;                                                             TRUE </span></span>
<span id="cb4-29"><a href="#cb4-29"></a><span class="co">#&gt; /services/data/v48.0/sobjects/Attachment/00P3s00000YvpM7EAJ/Body </span></span>
<span id="cb4-30"><a href="#cb4-30"></a><span class="co">#&gt;                                                             TRUE </span></span>
<span id="cb4-31"><a href="#cb4-31"></a><span class="co">#&gt; /services/data/v48.0/sobjects/Attachment/00P3s00000YvpMCEAZ/Body </span></span>
<span id="cb4-32"><a href="#cb4-32"></a><span class="co">#&gt;                                                             TRUE</span></span></code></pre></div>
<p><strong>Uploading large batches using the Bulk API</strong></p>
<p>The SOAP and REST APIs are good for working with a few attachements at a time. However, the Bulk API can be envoked using api_type=“Bulk 1.0” to automatically take a <code>data.frame</code> or <code>tbl_df</code> of Attachment field data and create a ZIP file with CSV manifest that is required by that API to upload In the example above we downloaded the 3 attachments each belonging to 2 different parent records. Assuming that I have a directory on my computer</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># create the attachment metadata required (Name, Body, ParentId)</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>attachment_details &lt;-<span class="st"> </span>queried_attachments <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Body =</span> <span class="kw">file.path</span>(Path, Name)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="st">  </span><span class="kw">select</span>(Name, Body, ParentId) </span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>result &lt;-<span class="st"> </span><span class="kw">sf_create_attachment</span>(attachment_details, <span class="dt">api_type=</span><span class="st">&quot;Bulk 1.0&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2"></a>result</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">#&gt; # A tibble: 6 x 4</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">#&gt;   Id                 Success Created Error</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">#&gt;   &lt;chr&gt;              &lt;lgl&gt;   &lt;lgl&gt;   &lt;lgl&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt; 1 00P3s00000YvpMMEAZ TRUE    TRUE    NA   </span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">#&gt; 2 00P3s00000YvpMNEAZ TRUE    TRUE    NA   </span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt; 3 00P3s00000YvpMOEAZ TRUE    TRUE    NA   </span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt; 4 00P3s00000YvpMPEAZ TRUE    TRUE    NA   </span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt; 5 00P3s00000YvpMQEAZ TRUE    TRUE    NA   </span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt; 6 00P3s00000YvpMREAZ TRUE    TRUE    NA</span></span></code></pre></div>
</div>
<div id="extending-to-documents-and-other-blob-data" class="section level3">
<h3>Extending to Documents and Other Blob Data</h3>
<p>The commands for working with Attachments also work for uploading documents and other blob data as well. Documents are just like Attachments in Salesforce except instead of having an associated ParentId they have an associated FolderId where the blob will be associated with upon creation. Here is a brief example of uploading a PDF (“Document”) to a Folder</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># the function supports inserting all types of blob content, just update the </span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co"># object_name argument to add the PDF as a Document instead of an Attachment</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>document_details &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Name =</span> <span class="st">&quot;Data Wrangling Cheatsheet - Test 1&quot;</span>,</span>
<span id="cb7-4"><a href="#cb7-4"></a>                           <span class="dt">Description =</span> <span class="st">&quot;RStudio cheatsheet covering dplyr and tidyr.&quot;</span>,</span>
<span id="cb7-5"><a href="#cb7-5"></a>                           <span class="dt">Body =</span> <span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, </span>
<span id="cb7-6"><a href="#cb7-6"></a>                                              <span class="st">&quot;data-wrangling-cheatsheet.pdf&quot;</span>,</span>
<span id="cb7-7"><a href="#cb7-7"></a>                                              <span class="dt">package=</span><span class="st">&quot;salesforcer&quot;</span>),</span>
<span id="cb7-8"><a href="#cb7-8"></a>                           <span class="dt">FolderId =</span> <span class="st">&quot;00l6A000001EgIwQAK&quot;</span>,</span>
<span id="cb7-9"><a href="#cb7-9"></a>                           <span class="dt">Keywords =</span> <span class="st">&quot;test,cheatsheet,document&quot;</span>)</span>
<span id="cb7-10"><a href="#cb7-10"></a>result &lt;-<span class="st"> </span><span class="kw">sf_create_attachment</span>(document_details, <span class="dt">object_name =</span> <span class="st">&quot;Document&quot;</span>)</span>
<span id="cb7-11"><a href="#cb7-11"></a>result</span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co">#&gt;   id                 success</span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="co">#&gt;   &lt;chr&gt;              &lt;lgl&gt;  </span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">#&gt; 1 0153s000001gWnAAAU TRUE</span></span></code></pre></div>
<p>With Documents, users are also able to save storage by specifying a <code>Url</code> instead of a a file path where the <code>Body</code> content is stored locally. Specifying the <code>Url</code> field will reference the URL instead of uploading into the Salesforce org, thereby saving space if limited in your organization.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>cheatsheet_url &lt;-<span class="st"> &quot;https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf&quot;</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>document_details &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Name =</span> <span class="st">&quot;Data Wrangling Cheatsheet - Test 2&quot;</span>,</span>
<span id="cb8-3"><a href="#cb8-3"></a>                           <span class="dt">Description =</span> <span class="st">&quot;RStudio cheatsheet covering dplyr and tidyr.&quot;</span>,</span>
<span id="cb8-4"><a href="#cb8-4"></a>                           <span class="dt">Url =</span> cheatsheet_url,  </span>
<span id="cb8-5"><a href="#cb8-5"></a>                           <span class="dt">FolderId =</span> <span class="st">&quot;00l6A000001EgIwQAK&quot;</span>,</span>
<span id="cb8-6"><a href="#cb8-6"></a>                           <span class="dt">Keywords =</span> <span class="st">&quot;test,cheatsheet,document&quot;</span>)</span>
<span id="cb8-7"><a href="#cb8-7"></a>result &lt;-<span class="st"> </span><span class="kw">sf_create_attachment</span>(document_details, <span class="dt">object_name =</span> <span class="st">&quot;Document&quot;</span>)</span>
<span id="cb8-8"><a href="#cb8-8"></a>result</span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co">#&gt;   id                 success</span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">#&gt;   &lt;chr&gt;              &lt;lgl&gt;  </span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">#&gt; 1 0153s000001gWnFAAU TRUE</span></span></code></pre></div>
</div>
<div id="reference-links" class="section level3">
<h3>Reference Links</h3>
<p>Below is a list of links to existing Salesforce documentation that provide more detail into how Attachments, Documents, and other blob data are handled via their APIs. As with many functions in <strong>salesforcer</strong>, we have tried to tranlate these functions exactly as they are described in the Salesforce documentation so that they are flexible enough to handle most all cases that the APIs were intended to support.</p>
<ul>
<li><p><strong>Attachment Object</strong>: <a href="https://developer.salesforce.com/docs/atlas.en-us.api.meta/api/sforce_api_objects_attachment.htm" target="_blank">https://developer.salesforce.com/docs/atlas.en-us.api.meta/api/sforce_api_objects_attachment.htm</a></p></li>
<li><p><strong>Document Object</strong>: <a href="https://developer.salesforce.com/docs/atlas.en-us.api.meta/api/sforce_api_objects_document.htm" target="_blank">https://developer.salesforce.com/docs/atlas.en-us.api.meta/api/sforce_api_objects_document.htm</a></p></li>
<li><p><strong>REST API Upload Attachment</strong>: <a href="https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/dome_sobject_insert_update_blob.htm" target="_blank">https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/dome_sobject_insert_update_blob.htm</a></p></li>
<li><p><strong>Bulk API Upload Attachments</strong>: <a href="https://developer.salesforce.com/docs/atlas.en-us.api_asynch.meta/api_asynch/binary_intro.htm" target="_blank">https://developer.salesforce.com/docs/atlas.en-us.api_asynch.meta/api_asynch/binary_intro.htm</a></p></li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
